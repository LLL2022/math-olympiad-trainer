<!DOCTYPE html>
<html>
<head>
    <title>Math Olympiad Trainer</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
<div class="mainbody">
    <h1>Math Olympiad Trainer</h1>

    <!-- SECTION 1: SINGLE PROBLEM-->

    <!-- Customization - Choosing Difficulty-->

    <!-- Customization - Choosing Topic-->
    <div align="center">
        <div class="custom-select" style="display: inline-block">
        <form id="form1">
        <select data-placeholder="Type a topic..." multiple class="chosen-select" name="form1">
            <option value='Algebra' selected>Algebra</option>
            <option value='Combinatorics' selected>Combinatorics</option>
            <option value='Geometry' selected>Geometry</option>
            <option value='Number Theory' selected>Number Theory</option>
        </select> 
        </form>
        </div> 

    <!-- Customization - Choosing Source-->
        <div class="custom-select" style="display: inline-block">
        <form id="form2">
        <select multiple>
            <option value='IMO' selected>IMO</option>
            <option value='APMO' selected>APMO</option>
            <option value='CHKMO' selected>CHKMO</option>
            <option value='Test 2' selected>Test 2</option>
            <option value='Test 1' selected>Test 1</option>
            <option value='IMO Prelim' selected>IMO Prelim</option>
        </select>
        </form>
        </div> 
    </div>

    <br>
    <!-- Random Problem generator-->
    <button id="generate-text" class="randomproblem">Random Problem</button>
    <p id="random-text" class="random-text"></p>

    <!-- Answer box (NEED TO INCLUDE CODE FOR CHECKING ANS/DISAPPEARING FOR PROOF QUESTIONS)-->
    <form action="test.php" method="GET">
        <!-- test.php is not a real thing, need to edit-->
    
        <input type="text" id="answerbox" placeholder="Enter answer:">
        <input type="submit">

    </form>

    <br>
    <button id="generate-sol">Show Solution</button>
    <p id="sol-text"></p>

    <!-- Problem Set generator -->

    <button id="generate-pset">Random Problem Set</button>

    <div id="buttonContainer"></div>


    <!-- Below is JS code for Random Problem function -->
    <script>
        $(document).ready(function() {
            var twoDArray;

            fetch('/test/problems_test.csv')
                .then(function(response) {
                    return response.text();
                })
                .then(function(data) {
                    // Parse the CSV data using the built-in CSV parser
                    var rows = data.trim().split('\n');
                    twoDArray = rows.map(function(row) {
                        return row.split(',');
                    });

                    // Now, twoDArray should contain all the entries from the CSV file
                    console.log(twoDArray);

                    var info;
                    var flag = "problem";
                    var solution = "";

                    // Getting info about which subjects
                    var subjectSelect = document.querySelector('form#form1 select[multiple]');
                    console.log(subjectSelect);
                    var subjectStr = ['A', 'C', 'G', 'N'];

                    // Function to get the selected/not selected status of each option
                    function getSelectedStatus(subjectSelect) {
                        var selectedStatus = [];

                        for (var i = 0; i < subjectSelect.options.length; i++) {
                            selectedStatus.push(subjectSelect.options[i].selected);
                        }

                        return selectedStatus;
                    }

                    // Getting info about which sources
                    var sourceSelect = document.querySelector('form#form2 select[multiple]');
                    console.log(sourceSelect);
                    var sourceStr = ['IMO', 'APMO', 'CHKMO', 'T2', 'T1', 'Prelim'];

                    // Single random problem
                    $('#generate-text').click(function() {
                        solution = "";
                        flag = "problem";

                        // Call the getSelectedStatus function to get the array of possible subjects
                        var selectedStatus = getSelectedStatus(subjectSelect);
                        var possibleSubjects = [];

                        for (var i = 0; i < 4; i++) {
                            if (selectedStatus[i]) {
                                possibleSubjects.push(subjectStr[i]);
                            }
                        }

                        // Create list of possible problems based on topic
                        var problemListArray = [];
                        for (var i = 1; i < twoDArray.length; i++) {
                            var infoConsidered = twoDArray[i];
                            var infoConsideredProcessed = infoConsidered.join(', ').split(";;");
                            var subjectConsidered = infoConsideredProcessed[4];

                            if (possibleSubjects.includes(subjectConsidered)) {
                                problemListArray.push(infoConsidered);
                            }
                        }

                        console.log(problemListArray);

                        // Array of possible sources
                        var selectedStatusSource = getSelectedStatus(sourceSelect);
                        var possibleSources = [];

                        for (var i = 0; i < 6; i++) {
                            if (selectedStatusSource[i]) {
                                possibleSources.push(sourceStr[i]);
                            }
                        }

                        // Create list of possible problems based on source
                        var problemListArrayNew = [];
                        for (var i = 1; i < problemListArray.length; i++) {
                            var infoConsideredNew = problemListArray[i];
                            var infoConsideredProcessedNew = infoConsideredNew.join(', ').split(" ");
                            var sourceConsidered = infoConsideredProcessedNew[0];

                            if (possibleSources.includes(sourceConsidered)) {
                                problemListArrayNew.push(infoConsideredNew);
                            }
                        }

                        console.log(problemListArrayNew);

                        // Random problem

                        var randomrow = problemListArrayNew[Math.floor(Math.random() * problemListArrayNew.length)];
                        var randomText = randomrow.join(', ');

                        // JS splits based on commas, not semicolons
                        // We concatenate everything them split based on semicolons manually

                        info = randomText.split(";;");
                        let question = info.at(-2);
                        solution = info.at(-1);

                        $('#random-text').html(question);
                        MathJax.typeset();
                        $('#sol-text').html("");
                    });

                    // To show solution
                    $('#generate-sol').click(function() {
                        console.log(solution);
                        $('#sol-text').html(solution);
                        MathJax.typeset();
                    });

                    // Problem Set
                    $('#generate-pset').click(function() {
                        flag = "pset";
                        solution = "";

                        // Call the getSelectedStatus function to get the array of possible subjects
                        var selectedStatus = getSelectedStatus(subjectSelect);
                        var possibleSubjects = [];

                        for (var i = 0; i < 4; i++) {
                            if (selectedStatus[i]) {
                                possibleSubjects.push(subjectStr[i]);
                            }
                        }

                        // Create list of possible problems based on topic
                        var problemListArray = [];
                        for (var i = 1; i < twoDArray.length; i++) {
                            var infoConsidered = twoDArray[i];
                            var infoConsideredProcessed = infoConsidered.join(', ').split(";;");
                            var subjectConsidered = infoConsideredProcessed[4];

                            if (possibleSubjects.includes(subjectConsidered)) {
                                problemListArray.push(infoConsidered);
                            }
                        }

                        console.log(problemListArray);

                        // Array of possible sources
                        var selectedStatusSource = getSelectedStatus(sourceSelect);
                        var possibleSources = [];

                        for (var i = 0; i < 6; i++) {
                            if (selectedStatusSource[i]) {
                                possibleSources.push(sourceStr[i]);
                            }
                        }

                        // Create list of possible problems based on source
                        var problemListArrayNew = [];
                        for (var i = 1; i < problemListArray.length; i++) {
                            var infoConsideredNew = problemListArray[i];
                            var infoConsideredProcessedNew = infoConsideredNew.join(', ').split(" ");
                            var sourceConsidered = infoConsideredProcessedNew[0];

                            if (possibleSources.includes(sourceConsidered)) {
                                problemListArrayNew.push(infoConsideredNew);
                            }
                        }

                        console.log(problemListArrayNew);

                        var N = 10;

                        var pset = "";

                        for (var i = 0; i < N; i++) {
                            // Random problem

                            var randomrow = problemListArrayNew[Math.floor(Math.random() * problemListArrayNew.length)];
                            var randomText = randomrow.join(', ');

                            // JS splits based on commas, not semicolons
                            // We concatenate everything them split based on semicolons manually

                            info = randomText.split(";;");
                            let question = info.at(-2);
                            let singlesolution = info.at(-1);

                            pset += question + "<br><br>";
                            solution += singlesolution + "<br><br>";
                        }

                        $('#random-text').html(pset);
                        MathJax.typeset();
                        $('#sol-text').html("");
                    });
                })
                .catch(function(error) {
                    console.error('Error reading CSV file:', error);
                });
        });
    </script>
</div>
</body>
</html>